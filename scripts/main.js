function updateDepth(a,b){var c=a.turn("page"),d=a.turn("pages"),e=16*Math.min(1,2*c/d);b=b||c,b>3?$(".sj-book .p2 .depth").css({width:e,left:20-e}):$(".sj-book .p2 .depth").css({width:0}),e=16*Math.min(1,2*(d-c)/d),d-3>b?$(".sj-book .p15 .depth").css({width:e,right:20-e}):$(".sj-book .p15 .depth").css({width:0})}function numberOfViews(a){return a.turn("pages")/2+1}function getViewNumber(a,b){return parseInt((b||a.turn("page"))/2+1,10)}function moveBar(a){Modernizr&&Modernizr.csstransforms&&$("#slider .ui-slider-handle").css({zIndex:a?-1:1e4})}function isChrome(){return-1!=navigator.userAgent.indexOf("Chrome")}function loadApp(){var a=$(".sj-book"),b=$("#slider"),c=0;b.slider({min:1,max:100,start:function(a,b){moveBar(!1),c=$(this).slider("value")},stop:function(){var a=0;a=$(this).slider("value")>c?2*$(this).slider("value")-2:2*$(this).slider("value")-1,$(".sj-book").turn("page",Math.max(1,a))}}),Hash.on("^page/([0-9]*)$",{yep:function(b,c){var d=c[1];void 0!==d&&a.turn("is")&&a.turn("page",d)},nop:function(b){a.turn("is")&&a.turn("page",1)}}),$(document).keydown(function(b){var c=37,d=39;switch(b.keyCode){case c:a.turn("previous");break;case d:a.turn("next")}});var d=Math.min($(window).height(),670),e=d-70,f=e/600*960;return $(".hard").css({width:f/2+"px",height:e+"px"}),$("#canvas").css({width:f+"px",height:e+"px"}),$(".own-size").css({width:f/2-20+"px",height:e-18+"px"}),$(".show-img").css({height:e/3+"px"}),a.turn({elevation:50,acceleration:!isChrome(),autoCenter:!0,gradients:!0,duration:1e3,pages:16,width:f,height:e,when:{turning:function(a,b,c){var d=$(this),e=d.turn("page"),f=d.turn("pages");if(e>3&&f-3>e){if(1==b)return d.turn("page",2).turn("stop").turn("page",b),void a.preventDefault();if(b==f)return d.turn("page",f-1).turn("stop").turn("page",b),void a.preventDefault()}else if(b>3&&f-3>b){if(1==e)return d.turn("page",2).turn("stop").turn("page",b),void a.preventDefault();if(e==f)return d.turn("page",f-1).turn("stop").turn("page",b),void a.preventDefault()}updateDepth(d,b),b>=2?$(".sj-book .p2").addClass("fixed"):$(".sj-book .p2").removeClass("fixed"),b<d.turn("pages")?$(".sj-book .p15").addClass("fixed"):$(".sj-book .p15").removeClass("fixed"),Hash.go("page/"+b).update()},turned:function(a,c,d){var e=$(this);(2==c||3==c)&&e.turn("peel","br"),updateDepth(e),b.slider("value",getViewNumber(e,c)),e.turn("center")},start:function(a,b){moveBar(!0)},end:function(a,b){var c=$(this);setTimeout(function(){$("#slider").slider("value",getViewNumber(c))},1),moveBar(!1)}}}),0==a.width()||0==a.height()?void setTimeout(loadApp,10):(b.slider("option","max",numberOfViews(a)),a.addClass("animated"),void $("#canvas").css({visibility:""}))}$(window).width()>600&&($("#canvas").css({visibility:"hidden"}),yepnope({test:Modernizr.csstransforms,yep:["./scripts/turn.min.js"],nope:["./scripts/turn.html4.min.js","./styles/jquery.ui.html4.css"],both:["./styles/jquery.ui.css"],complete:loadApp}));